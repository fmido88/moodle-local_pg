define("local_pg/preview",["exports","jquery","core/yui","core/modal","core/prefetch","core/ajax","core/str"],(function(_exports,_jquery,_yui,_modal,_prefetch,_ajax,_str){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * This module is used to help preview the page and highlight syntax for css and js codes.
   *
   * @module     local_pg/preview
   * @copyright  2025 Mohammad Farouk <phun.for.physics@gmail.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_yui=_interopRequireDefault(_yui),_modal=_interopRequireDefault(_modal),_prefetch=_interopRequireDefault(_prefetch),_ajax=_interopRequireDefault(_ajax),_prefetch.default.prefetchStrings("local_pg",["jssyntaxerror","csssyntaxerror"]);let draftLangs={};async function jsValidation(cm){let errorPlaceholder=(0,_jquery.default)("#js-text-error");var code=cm.getValue();try{Function(code),cm.save(),errorPlaceholder.text(""),errorPlaceholder.hide(),(0,_jquery.default)("input[type=submit]").removeAttr("disabled")}catch(e){errorPlaceholder.text(await(0,_str.get_string)("jssyntaxerror","local_pg",e.message)),errorPlaceholder.show(),(0,_jquery.default)("input[type=submit]").attr("disabled",!0)}}async function validateCSS(cm){let errorPlaceholder=(0,_jquery.default)("#css-text-error"),cssCode=cm.getValue().trim(),errors=[];if(void 0!==window.CSSLint){errors=window.CSSLint.verify(cssCode).messages.map((msg=>"Line ".concat(msg.line,": ").concat(msg.message)))}else try{let style=document.createElement("style");style.textContent=cssCode,document.head.appendChild(style),0===style.sheet.cssRules.length&&""!==cssCode&&errors.push("Invalid CSS detected."),document.head.removeChild(style)}catch(e){errors.push("Invalid CSS syntax.")}errors.length>0?(errorPlaceholder.text(await(0,_str.get_string)("csssyntaxerror","local_pg",errors.join("\n"))),errorPlaceholder.show()):(cm.save(),errorPlaceholder.text(""),errorPlaceholder.hide())}function savedraftlang(){let lang=(0,_jquery.default)("[name=lang]").val(),title=(0,_jquery.default)("[name=header]").val(),content=(0,_jquery.default)('[name="content_editor[text]"]').val();draftLangs[lang]={header:title,content:content},console.log(draftLangs)}_exports.init=()=>{(0,_jquery.default)((function(){setTimeout((function(){_yui.default.use(["moodle-atto_html-codemirror","moodle-atto_html-beautify"],(function(Y){var CodeMirror=Y.M.atto_html.CodeMirror,beautify=Y.M.atto_html.beautify,jsTextarea=(0,_jquery.default)('textarea[name="js"]');let jsCodeMirror;jsTextarea[0]&&(beautify.js_beautify(jsTextarea.val(),{indent_size:4}),jsCodeMirror=CodeMirror.fromTextArea(jsTextarea[0],{lineNumbers:!0,mode:"javascript",tabSize:4,lineWrapping:!0,indentWithTabs:!1,spellcheck:!0}),jsCodeMirror.setSize("100%","300px"),jsCodeMirror.on("change",jsValidation));var cssTextarea=(0,_jquery.default)('textarea[name="css"]');let cssCodeMirror;cssTextarea[0]&&(beautify.css_beautify(cssTextarea.val(),{indent_size:2}),cssCodeMirror=CodeMirror.fromTextArea(cssTextarea[0],{lineNumbers:!0,mode:"css",tabSize:2,lineWrapping:!0,indentWithTabs:!1,spellcheck:!0}),cssCodeMirror.setSize("100%","300px"),cssCodeMirror.on("change",validateCSS)),(0,_jquery.default)("[name=lang]").on("change",(function(){let readOnly=""!==(0,_jquery.default)(this).val();jsCodeMirror&&jsCodeMirror.setOption("readOnly",readOnly),cssCodeMirror&&cssCodeMirror.setOption("readOnly",readOnly),async function(){console.log(draftLangs);let lang=(0,_jquery.default)("[name=lang]").val(),disable=""!=lang;if((0,_jquery.default)("[name=shortname]").attr("readonly",disable),draftLangs[lang])return draftLangs[lang].header&&(0,_jquery.default)("[name=header]").val(draftLangs[lang].header),void(draftLangs[lang].content&&((0,_jquery.default)('[name="content_editor[text]"]').val(draftLangs[lang].content),(0,_jquery.default)("#id_content_editoreditable").html(draftLangs[lang].content)));draftLangs[lang]={header:void 0,content:void 0};let requests=_ajax.default.call([{methodname:"local_pg_get_lang_content",args:{id:(0,_jquery.default)("[name=id]").val(),lang:lang}}]),response=await requests[0];response.header&&((0,_jquery.default)("[name=header]").val(response.header),draftLangs[lang].header=response.header),response.content&&((0,_jquery.default)('[name="content_editor[text]"]').val(response.content),draftLangs[lang].content=response.content,(0,_jquery.default)("#id_content_editoreditable").html(response.content))}()}))}))}),1e3),(0,_jquery.default)('button[name="preview"]').on("click",(function(){!async function(){let url=new URL(M.cfg.wwwroot+"/local/pg/preview.php");url.searchParams.set("shortname",(0,_jquery.default)('[name="shortname"]').val()),url.searchParams.set("header",(0,_jquery.default)('[name="header"]').val()),url.searchParams.set("content",(0,_jquery.default)('[name="content_editor[text]"]').val()),url.searchParams.set("contentformat",(0,_jquery.default)('[name="content_editor[format]"]').val()),url.searchParams.set("layout",(0,_jquery.default)('[name="layout"]').val()),url.searchParams.set("css",(0,_jquery.default)('[name="css"]').val()),url.searchParams.set("js",(0,_jquery.default)('[name="js"]').val());let lang=(0,_jquery.default)("[name=lang]").val();lang&&url.searchParams.set("lang",lang),(await _modal.default.create({large:!0,show:!0,removeOnClose:!0,body:'<iframe src="'.concat(url.href,'" class="embed-responsive-item"></iframe>'),title:"Preview"})).show(),(0,_jquery.default)('[data-region="body"]').addClass("embed-responsive").addClass("embed-responsive-16by9"),(0,_jquery.default)('[data-region="modal"]').attr("style","max-width: 100%; max-height: 100%; padding: 0; margin: 0;")}()})),(0,_jquery.default)('[name="content_editor[text]"], [name="header"]').on("input, change",savedraftlang),savedraftlang()}))}}));

//# sourceMappingURL=preview.min.js.map